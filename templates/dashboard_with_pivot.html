{% load static %}



<!-- 
<head>
  <meta charset="UTF-8">
  <title>Dashboard with Flexmonster</title>
  {% comment %} <script src="{% static 'js/custom.js' %}"></script> {% endcomment %}
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.23.0/pivot.min.js"></script>
  <scrpt src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.13.0/pivot.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.6.0/tips_data.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.13.0/pivot.min.css">

  <link rel="stylesheet" href="{% static 'css/custom.css' %}">
</head>
<body>
<div id="pivot-table-container" data-url="{% url 'pivot_table' %}"></div>
<div id="output"></div>


<script>
function processData(dataset) {
    var result = []
    dataset = JSON.parse(dataset);
    dataset.forEach(item => result.push(item.fields));
    return result;
}
$.ajax({
    url: $("#pivot-table-container").attr("data-url"),
    dataType: 'json',
    success: function(data) {
        
        var heatmap =  utils.renderers["Heatmap"];
        var sumOverSum =  utils.aggregators["Sum over Sum"];

        $("#output").pivot(
        utils.tipsData, {
            rows: ["sex", "smoker"],
            cols: ["day", "time"],
            aggregator: sumOverSum(["tip", "total_bill"]),
            renderer: heatmap
        });

        /*
        new Flexmonster({
            container: "#pivot-table-container",
            componentFolder: "https://cdn.flexmonster.com/",
            width: "100%",
            height: 430,
            toolbar: true,
            report: {
                dataSource: {
                    type: "json",
                    data: processData(data)
                },
                slice: {}
            }
        });
        */
        console.log(data);
        /*
        $("#output").pivotUI(
        $.pivotUtilities.tipsData, {
            rows: ["sex"],
            cols: ["smoker"],
            vals: ["tip", "total_bill"],
            aggregatorName: "Sum over Sum",
            rendererName: "Bar Chart",
            renderers: $.extend(
                $.pivotUtilities.renderers, 
            $.pivotUtilities.plotly_renderers
            )
        });
        */

        //console.log(data);
        /*
        new Flexmonster({
            container: "#pivot-chart-container",
            componentFolder: "https://cdn.flexmonster.com/",
            width: "100%",
            height: 430,
            toolbar: true,
            report: {
                dataSource: {
                    type: "json",
                    data: processData(data)
                },
                slice: {},
                "options": {
                    "viewType": "charts",
                    "chart": {
                        "type": "pie"
                    }
                }
            }
        });
        */
    }
});
</script>
</body>

-->

<!DOCTYPE html>
<html>
    <head>
        <title>Pivot Demo</title>

        <!-- external libs from cdnjs -->
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.css">
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.11/c3.min.js"></script>

        <!-- PivotTable.js libs from ../dist -->
        <link rel="stylesheet" type="text/css" href="{% static 'dist/pivot.css'%}">
        <script type="text/javascript" src="{% static 'dist/pivot.js'%}"></script>
        <script type="text/javascript" src="{% static 'dist/export_renderers.js'%}"></script>
        <script type="text/javascript" src="{% static 'dist/d3_renderers.js'%}"></script>
        <script type="text/javascript" src="{% static 'dist/c3_renderers.js'%}"></script>

        <!-- for examples only! script to show code to user -->
        <!-- <script type="text/javascript" src="{% static 'js/show_code.js'%}"></script> -->
    </head>
    <body>


    <div id="pivot-table-container" data-url="{% url 'pivot_table' %}"></div>
<div id="output"></div>


        <script type="text/javascript">
            "use strict";
    // This example has all the renderers loaded,
    // and should work with touch devices.
    function jobj(data){

    }
    $(function(){
        var derivers = $.pivotUtilities.derivers;

        var renderers = $.extend(
            $.pivotUtilities.renderers,
            $.pivotUtilities.plotly_renderers,
            $.pivotUtilities.c3_renderers,
            $.pivotUtilities.d3_renderers,
            $.pivotUtilities.export_renderers
            );
        $.getJSON(location.pathname+'/pivot-table',function(data){
            var fields = []
            var loop = JSON.parse(data).map(function(e){
                fields.push(e['fields']);
            });
            //console.log(JSON.stringify(data))
            $("#output").pivotUI(fields);
        },'json');
        //$.ajax({
        //    url: location.pathname+'/pivot-table',
        //    dataType: 'json',
        //    success: function(data) {
        //    console.log(typeof data);
        //    $("#output").pivotUI(data);
        //    }
        //});
     });
    
        </script>
    </body>
</html>